function importCSV(e){e.stopPropagation(e),e.preventDefault(e);var t=e.dataTransfer.files,r=t.length;switch(r){case 1:parseFiles(t),warningImportCSV.style.display="none";break;default:warningImportCSV.style.display="block"}}function parseFiles(e){var t=e[0],r=t.name,a=r.replace(/^.*\./,"");switch(a){case"csv":case"txt":errorImportCSV.style.display="none";var n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=handleReaderLoad;break;default:errorImportCSV.style.display="block"}}function handleReaderLoad(e){var t=e.target.result;dropImportCSV.value=t.split(";")}var collectionHolder=$("table.entries tbody"),dropImportCSV=document.getElementById("importCSV"),errorImportCSV=document.getElementById("errorImportCSV"),warningImportCSV=document.getElementById("warningImportCSV");jQuery(document).ready(function(){$(".add-import-entry").click(function(e){e.preventDefault(),$(".row-import-entries").show(300)}),$(".btn-import-cancel").click(function(e){e.preventDefault(),$("#importCSV").val(""),$("#errorImportCSV").hide(),$("#warningImportCSV").hide(),$(".row-import-entries").hide(300)}),$(".add-import-entry-do").click(function(e){e.preventDefault();var t=$.csv.toArrays($(".add-import-entry-data").val(),{headers:!1,seperator:",",delimiter:'"'});if("undefined"!=typeof t[0]){-1==t[0][1].indexOf("@")&&t.splice(0,1);var r=0,a=!0;for(var n in t){var o="",d="";for(var i in t[n])""==o&&-1!=t[n][i].indexOf("@")?o=t[n][i]:d=t[n][i];""!=o&&(""==d&&(d=o),a?(elem=$(collectionHolder).find('.entry-name[value=""],.entry-name:not([value])'),elem.length>0?(row=$(elem[0]).parent().parent(),$(row).find(".entry-name").attr("value",d),$(row).find(".entry-mail").attr("value",o)):(a=!1,addNewEntry(collectionHolder,o,d))):addNewEntry(collectionHolder,o,d),r++)}r>0&&($(".add-import-entry-data").val(""),$(".row-import-entries").hide(300))}}),$(".add-import-entry-data").change(function(){data=$(this).val().replace(/\t/g,",").replace(/;/g,","),data!=$(this).text()&&$(this).val(data)})}),dropImportCSV.addEventListener("dragenter",function(e){e.stopPropagation(e),e.preventDefault(e)}),dropImportCSV.addEventListener("dragover",function(e){return e.stopPropagation(e),e.preventDefault(e),!1}),dropImportCSV.addEventListener("drop",importCSV,!1);